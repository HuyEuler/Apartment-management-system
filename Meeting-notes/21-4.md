# Họp PTTK 21/4 :
## Tóm tắt góp ý của thầy 
- Mỗi loại biểu đồ vẽ 1 số chức năng đặc trưng, hay nhất (khoảng 4). 
- Đi từ phân tích các usecase -> luồng hoạt động -> biểu đồ lớp lĩnh vực -> DB. 
- usecase đơn giản, thiếu tương tác các bên.
- Khi trình bày phải có diễn giải cho biểu đồ chứ không để thầy nhìn không như lần trước.

## Công việc triển khai 
- Chọn 4 usecase, dùng để vẽ usecase chi tiết, sequence, activity, state machine.
- Tìm hiểu lớp lĩnh việc . 

- 3 actor : Ban quản lý, khách hàng, nhà cung cấp dịch vụ.
- Mô tả các usecase.

  - Khách hàng :
    - Đăng ký tài khoản, đăng nhập
    - Xem , sửa thông tin
    - Xem thông tin chung cư 
    - Đặt phòng : tạm trú, thường trú (chỉ định phòng) (v)
    - Đổi phòng 
    - Rời đi
    - Xem số tiền cần đóng
    - Đóng tiền qua website (v)
    - Chat với ban quản lý
    - Gửi xe (p)
  - Ban quản lý :
    - Đăng nhập hệ thống
    - Xem danh sách, quản lý thông tin cư dân
    - Xem danh sách, quản lý thông tin phòng (v)
    - Duyệt yêu cầu cư dân (đặt phòng, đổi phòng, trả phòng)
    - Tạo thanh toán cho 1 khoản phí (hàng tháng, đóng 1 lần , ..) (v)
    - Xem lịch sử thanh toán 
    - Thông báo cho cư dân (v)
    - Xuất báo cáo thống kê

(1) Đặt phòng : 
Khách hàng -> Xem danh sách phòng trống -> Lựa chọn phòng -> Đặt phòng 
Ban quản lý -> xem xét các yêu cầu -> chấp thuận hoặc từ chối yêu cầu -> trả về thông báo 

(2) Thanh toán khoản phí : 
Ban quản lý -> lấy dữ liệu thanh toán từ nhà cung cấp dịch vụ -> tạo thanh toán cho từng phòng / cá nhân
Khách hàng -> Xem khoản thanh toán -> Đóng tiền 
Ban quản lý -> cập nhật dữ liệu thanh toán 

(3) Báo cáo cho ban quản lý : 
Khách hàng -> gửi báo cáo cho ban quản lý (về 1 tình trạng)
Ban quản lý -> nhận báo cáo từ khách hàng -> phân loại yêu cầu (chia tag) -> 

(4) Thay đổi trạng thái cư trú : 
Khách hàng -> cập nhật trạng thái cư trú 
Ban quản lý -> xem xét các yêu cầu -> chấp thuận hoặc từ chối yêu cầu -> trả về thông báo 

(5) Cập nhật hồ sơ : 
Khách hàng / Ban quản lý -> cập nhật thông tin hồ sơ (tên, tuổi, giới tính, password, ...)

## Chi tiết vào các luồng công việc
### 1. Đặt phòng

- Luồng chính:
```
Khách hàng → Xem danh sách phòng trống → Lựa chọn phòng → Tạm khóa phòng (10 phút) → Cung cấp thông tin đặt phòng → Thanh toán đặt cọc → Ban quản lý xem xét yêu cầu → Chấp thuận hoặc từ chối → Thông báo kết quả cho khách hàng
```

- **Chi tiết các bước và các trường hợp có thể xảy ra**
```
Khách hàng
  ↓
Xem danh sách phòng trống
  ↪ (Không có phòng trống) ⇐ Thông báo: "Hiện tại không có phòng trống. Vui lòng quay lại sau." ⇐ Kết thúc
  ↓
Lựa chọn phòng
  ↪ (Phòng đã được người khác đặt) ⇐ Thông báo: "Phòng đã được đặt. Vui lòng chọn phòng khác." ⇐ Quay lại "Xem danh sách phòng trống"
  ↓
Tạm khóa phòng (10 phút)
  ↪ (Hết thời gian 10 phút, chưa hoàn tất) ⇐ Hủy giữ chỗ, mở khóa phòng ⇐ Quay lại "Xem danh sách phòng trống"
  ↓
Cung cấp thông tin đặt phòng
  ↪ (Thông tin không hợp lệ) ⇐ Thông báo: "Thông tin không hợp lệ. Vui lòng nhập lại." ⇐ Quay lại "Cung cấp thông tin đặt phòng"
  ↓
Thanh toán đặt cọc
  ↪ (Thanh toán thất bại) ⇐ Thông báo: "Thanh toán không thành công. Vui lòng thử lại." ⇐ Quay lại "Thanh toán đặt cọc"
  ↪ (Hết thời gian 10 phút, chưa thanh toán) ⇐ Hủy giữ chỗ, mở khóa phòng ⇐ Quay lại "Xem danh sách phòng trống"
  ↓
Ban quản lý xem xét yêu cầu (trong 24 giờ)
  ↪ (Thông tin khách hàng không hợp lệ) ⇐ Từ chối, hoàn tiền đặt cọc, thông báo: "Yêu cầu bị từ chối vì thông tin không hợp lệ." ⇐ Kết thúc
  ↪ (Phòng không còn trống do lỗi hệ thống) ⇐ Từ chối, hoàn tiền đặt cọc, thông báo: "Phòng không còn trống." ⇐ Kết thúc
  ↪ (Không phản hồi trong 24 giờ) ⇐ Tự động từ chối, hoàn tiền, thông báo: "Yêu cầu bị từ chối do hết thời gian xử lý." ⇐ Kết thúc
  ↓
Chấp thuận hoặc từ chối
  ↪ (Chấp thuận) → Cập nhật trạng thái phòng thành "Đã đặt" → Thông báo: "Yêu cầu đã được chấp thuận. Vui lòng ký hợp đồng trong 48 giờ." → Kết thúc
  ↪ (Từ chối) → Hoàn tiền đặt cọc → Thông báo: "Yêu cầu bị từ chối vì [lý do]." → Kết thúc
```

- **Đề xuất thêm trường hợp**

a. Hủy đặt phòng
```
Khách hàng
↓
Yêu cầu hủy đặt phòng (trước khi ký hợp đồng)
↪ (Hủy trước 24 giờ) → Hoàn 100% tiền đặt cọc → Ban quản lý xác nhận → Cập nhật trạng thái phòng thành "Trống" → Thông báo: "Hủy thành công, hoàn 100% tiền đặt cọc." → Kết thúc
↪ (Hủy sau 24 giờ) → Hoàn 50% tiền đặt cọc → Ban quản lý xác nhận → Cập nhật trạng thái phòng thành "Trống" → Thông báo: "Hủy thành công, hoàn 50% tiền đặt cọc." → Kết thúc
↪ (Đã ký hợp đồng) ⇐ Áp dụng chính sách hủy hợp đồng riêng ⇐ Kết thúc
```

b. Trường hợp phụ: Xử lý xung đột đặt phòng
```
Tạm khóa phòng
  ↪ (Nhiều khách hàng cùng đặt) → Ưu tiên khách hàng thanh toán trước → Thông báo khách hàng còn lại: "Phòng đã được đặt bởi người khác." → Quay lại "Xem danh sách phòng trống"
```


## Phân công công việc 
